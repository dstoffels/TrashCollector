{% extends 'employees/employee_base.html' %}

{% block title %} Employee Home {% endblock %}

{% block header %} Employee Portal {% endblock %}

{% block content %}

{% if user.is_authenticated %}
<h3 class="mt-4 mb-5 fw-normal">Hello, {{ logged_in_employee.first_name }}!</h3>

<div style="width: 500px; height: 400px" id="map"></div>

<table class="table center-table table-dark align-middle">
  <thead>
    <tr>
      <th>Customer Name</th>
      <th>Address</th>
      <th>Zip Code</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    {% for customer in customers %}
    <tr>
      <td>{{customer.name}}</td>
      <td>{{customer.address}}</td>
      <td>{{customer.zip_code}}</td>
      <td><a class="btn btn-primary float-end" type="button"
          href="{% url 'employees:confirm_pickup' customer.id %}">Confirm
          pickup</a>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<p>You are at the employee home page, but you are not logged in.</p>
<a href="{% url 'login' %}">Log In</a>
<a href="{% url 'accounts:register' %}">Sign Up</a>
{% endif %}
{% endblock %}

{% block footer %}

<script>
  function initMap() {
    const customers = [
    {%for customer in customers %} 
      {
        name: '{{customer.name}}',
        address: '{{customer.address}}',
        coords:{
          lat: {{ customer.lat }}, 
          lng: {{ customer.lng }}, 
        }
      },
    {% endfor %}
    ]

    const map = new google.maps.Map(document.getElementById("map"), {
      zoom: 10,
      center: customers[0].coords
    });

    customers.map(cust => {
      new google.maps.Marker({
        position: cust.coords,
        map,
        title: `${cust.name}: ${cust.address}`,
      });
    })
  }
</script>
<script src="{{gmaps}}" async></script>
{% endblock %}